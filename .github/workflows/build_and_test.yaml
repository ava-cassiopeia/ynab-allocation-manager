name: Build and test

on:
  pull_request:
    branches: [main]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'

      - name: Build Docker image
        run: docker build -t ynab-allocation-manager-test .

      - name: Run tests in Docker
        # Note: If your tests require Firebase emulators and specific configurations,
        # you might need to pass through environment variables or use docker compose
        # with a more complex setup. For `firebase emulators:exec 'ng test ...'`,
        # this will run inside the container where firebase-tools is globally available.
        # The `npm test` script already handles `firebase emulators:exec`.
        # If tests need specific FIRESTORE_EMULATOR_HOST or other env vars for emulators,
        # they should be defined in the Dockerfile (less secure for secrets) or passed here.
        # For now, assuming `npm test` inside the container correctly starts emulators if needed.
        run: docker run --rm ynab-allocation-manager-test
